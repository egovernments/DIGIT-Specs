openapi: 3.0.1
info:
  title: Project Factory (Campaign Manager)
  description: BFF service APIs - to Bulk create, search and fetch all data in a registry.
  contact:
    name: eGov
    email: info@egovernments.org
  version: 1.0.0
servers:
- url: /project-factory/v1
paths:
  /project-factory/v1/data/_create:
    post:
      tags:
      - Bulk Data Creation
      summary: "This API endpoint used to do a bulk upload of data based on type"
      description: "This API endpoint used to do a bulk upload of data based on type"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
                ResourceDetails:
                  $ref: '#/components/schemas/ResourceDetails'
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                    $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  ResourceDetails:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/ResourceDetails'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/data/_search:
    post:
      tags:
      - Bulk Data Creation
      summary: "This API endpoint searches for API resources"
      description: "This API endpoint searches for API resources"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
                SearchCriteria:
                  $ref: '#/components/schemas/SearchCriteria'
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                    $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  ResponseDetails:
                    type: "array"
                    items:  
                      $ref: '#/components/schemas/ResourceDetails'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/data/template/_generate:
    post:
      tags:
      - Bulk Data retrieval
      summary: "This API endpoint updates the API resources table"
      description: "This API endpoint updates the API resources table"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
      parameters:
      - name: tenantId
        in: query
        description: unique id for a tenant.
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: type
        in: query
        description: type of the resource
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: campaignId
        in: query
        description: campaign for which resource has to be generated
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: hierarchyType
        in: query
        description: type of the resource
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: forceUpdate
        in: query
        description: "ForceUpdate parameter"
        required: false
        schema:
          type: boolean
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                    $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  GeneratedResource:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/GeneratedResource'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/data/template/_download:
    post:
      tags:
      - Bulk Data retrieval
      summary: "This API endpoint updates the API resources table"
      description: "This API endpoint updates the API resources table"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
      parameters:
      - name: tenantId
        in: query
        description: unique id for a tenant.
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: type
        in: query
        description: type of the resource
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: hierarchyType
        in: query
        description: type of the resource
        required: true
        schema:
          maxLength: 256
          type: string
          format: varchar
      - name: id
        in: query
        description: unique id of the generated request
        required: false
        schema:
          maxLength: 256
          type: string
          format: varchar
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                    $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  GeneratedResource:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/GeneratedResource'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/project-type/create:
    post:
      tags:
      - Process Campaign
      summary: "This API endpoint used to do a bulk upload of data based on type"
      description: "This API endpoint used to do a bulk upload of data based on type"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
                CampaignDetails:
                  $ref: '#/components/schemas/CampaignResourceDetails'
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                      $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  CampaignDetails:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/CampaignResourceDetails'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/project-type/update:
    post:
      tags:
      - Process Campaign
      summary: "This API endpoint used to do a bulk upload of data based on type"
      description: "This API endpoint used to do a bulk upload of data based on type"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
                CampaignDetails:
                  $ref: '#/components/schemas/CampaignResourceDetails'
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                      $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  CampaignDetails:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/CampaignResourceDetails'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
  /project-factory/v1/project-type/search:
    post:
      tags:
      - Process Campaign
      summary: "This API endpoint searches for API resources"
      description: "This API endpoint searches for API resources"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/RequestInfo'
                CampaignDetails:
                  "$ref": "#/components/schemas/CampaignSearchCriteria"   
      responses:
        200:
          description: Successful Response.
          content:
            '*/*':
              schema:
                type: object
                properties:
                  ResponseInfo:
                      $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ResponseInfo'
                  CampaignDetails:
                    type: "array"
                    items:
                      $ref: '#/components/schemas/CampaignResourceDetails'
        400:
          description: Invalid input.
          content:
            '*/*':
              schema:
                $ref: 'https://raw.githubusercontent.com/egovernments/DIGIT-Specs/master/Common%20Services/common-contract.yaml#/components/schemas/ErrorRes'
                
  /project-factory/v1/project-type/getProcessTrack:
    post:
      tags:
      - Process Campaign
      summary: Get Process Track
      description: Fetches the process track for a specific campaign ID.
      parameters:
        - name: campaignId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier for the campaign.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                RequestInfo:
                  type: object
                  properties:
                    apiId:
                      type: string
                      example: Rainmaker
                    authToken:
                      type: string
                      example: 9b6e53ef-b2ee-4613-b4ff-ee6de99ce3b6
                    userInfo:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1284
                        uuid:
                          type: string
                          example: 867ba408-1b82-4746-8274-eb916e625fea
                        userName:
                          type: string
                          example: EMP57
                        name:
                          type: string
                          example: Jagan
                        mobileNumber:
                          type: string
                          example: 6667776662
                        emailId:
                          type: string
                          example: xyz@egovernments.org
                        locale:
                          type: string
                          example: string
                        type:
                          type: string
                          example: EMPLOYEE
                        roles:
                          type: array
                          items:
                            type: object
                            properties:
                              name:
                                type: string
                              code:
                                type: string
                              tenantId:
                                type: string
                        active:
                          type: boolean
                          example: true
                        tenantId:
                          type: string
                          example: mz
                        permanentCity:
                          type: string
                          example: Amritsar
                    msgId:
                      type: string
                      example: 1713593588138|en_MZ
                    plainAccessRequest:
                      type: object
                      additionalProperties: true
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  ResponseInfo:
                    type: object
                    properties:
                      apiId:
                        type: string
                        example: egov-bff
                      ver:
                        type: string
                        example: 0.0.1
                      ts:
                        type: integer
                        example: 1722848949604
                      status:
                        type: string
                        example: successful
                      desc:
                        type: string
                        example: new-response
                  processTrack:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 158efeca-6888-4360-a204-24f9c343f82a
                        campaignId:
                          type: string
                          example: 47108c06-b38e-41f2-8cb4-27771565638b
                        type:
                          type: string
                          example: trigger-resource-creation
                        status:
                          type: string
                          example: completed
                        showInUi:
                          type: boolean
                          example: false
                        details:
                          type: object
                          additionalProperties: true
                        additionalDetails:
                          type: object
                          additionalProperties: true
                        createdTime:
                          type: integer
                          example: 1722839084951
                        lastModifiedTime:
                          type: integer
                          example: 1722839086698
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error


components:
  schemas:
    ResourceDetails:
      type: object
      properties:
        id:
          type: "string"
          format: uuid
          example: "cf3bd20c-5ac3-4af1-a303-55445049b289"
          description: System generated unique identifier for the entry
          readOnly: true
        type:
          type: "string"
          example: "facility|user|boundarywithtarget"
        hierarchyType:
          type: "string"
          example: "admin|revenue"
        tenantId:
          type: "string"
        fileStoreId:
          type: "string"
          example: "a47e3f92-5c05-4abf-bf4e-17d2d4a35a72"
          format: uuid
          description: input file
        processedFileStoreId:
          type: "string"
          example: "a47e3f92-5c05-4abf-bf4e-17d2d4a35a72"
          format: uuid
          description: processed file with updated status
          readOnly: true
        campaignId:
          type: "string"
          example: "a47e3f92-5c05-4abf-bf4e-17d2d4a35a72"
          format: uuid
          description: campaign id for which data is getting created or validated
          readOnly: true
        status:
          readOnly: true
          type: "string"
          example: "data-accepted"
        action:
          type: "string"
          enum: 
            - "create"
            - "validate"
        additionalDetails:
          type: "object"
          example: {}
        auditDetails:
          readOnly: true
          type: "object"
          properties:
            createdBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            lastModifiedBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            createdTime:
              type: "string"
              example: "1644426612"
            lastModifiedTime:
              type: "string"
              example: "1644426612"
    CampaignResourceDetails:
      type: object
      properties:
        id:
          type: "string"
          format: uuid
          description: System generated unique identifier for the entry
          readOnly: true
        campaignNumber:
          type: "string"
          description: System generated formatted no
          example: "CAM/2023-24-0001"
          readOnly: true
        hierarchyType:
          type: "string"
          example: "admin"

        tenantId:
          type: "string"
          example: "mz"

        campaignName:
          type: "string"
          example: "Bednet LLIN"

        action:
          type: "string"
          example: "draft||create"
        startDate:
          type: number
          format: timestamp
          example: 1665497225000
          description: Timestamp of the start date in milliseconds
        endDate: 
          type: number
          format: timestamp
          example: 1665497225000
          description: Timestamp of the start date in milliseconds
        boundaries:
          type: "array"
          description: "As they select some boundaries at which they plan to run a campaign at"
          items:
            type: "object"
            properties:
              code:
                type: "string"
              type:
                type: "string"
              isRoot:
                type: "boolean"
              includeAllChildren:
                type: "boolean"
        projectId:
          type: "string"
          format: uuid
          description: System generated project id
          readOnly: true
        resources:
          type: "array"
          items:
            type: "object"
            properties:
              filestoreId:
                type: "string"
                example: "cf3bd20c-5ac3-4af1-a303-55445049b289"
              type:
                type: "string"
                example: "user"
              resourceId:
                type: "string"
                example: "cf3bd20c-5ac3-4af1-a303-55445049b289"
              filename:
                type: "string"
                example: "user.xlsx"
              createResourceId:
                type: "string"
                readOnly: true
                example: "cf3bd20c-5ac3-4af1-a303-55445049b289"
        projectType:
          type: "string"
        deliveryRules:
          type: "array"
          items:
            type: "object"
            properties:
              startDate:
                type: number
                format: timestamp
                example: 1665497225000
                description: Timestamp of the start date in milliseconds
              endDate: 
                type: number
                format: timestamp
                example: 1665497225000
                description: Timestamp of the start date in milliseconds
              cycleNumber:
                type: "number"
              deliveryNumber:
                type: "number"
              deliveryRuleNumber:
                type: "number"
              products:
                type: "array"
                items:
                  type: "string"
              conditions:
                type: "array"
                items:
                  type: "object"
                  properties:
                    attribute:
                      type: "string"
                    operator:
                      type: "string"
                    value:
                      type: "number" 
        additionalDetails:
          type: "object"
        auditDetails:
          readOnly: true
          type: "object"
          properties:
            createdBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            lastModifiedBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            createdTime:
              type: "string"
              example: "1644426612"
            lastModifiedTime:
              type: "string"
              example: "1644426612"

    SearchCriteria:
      type: "object"
      properties:
        id:
          type: "array"
          items:
            type: "string"
        tenantId:
          type: "string"
        type:
          type: "string"
        status:
          type: "string"
    CampaignSearchCriteria:
      type: "object"
      properties:
        ids:
          type: "array"
          items:
            type: "string"
        tenantId:
          type: "string"
        projectType:
          type: "string"
        campaignName:
          type: "string"
        status:
          type: "string"
        createdBy:
          type: "string"
        campaignNumber:
          type: "string"
        pagination:
          type: "object"
          properties:
            sortBy:
              description: sort the search results by fields
              type: string
              enum:
                - createdTime
            sortOrder:
              description: sorting order of the search resulsts
              type: string
              enum:
                - asc
                - desc
            limit:
              description: limit on the resulsts
              type: number
            offset:
              description: offset index of the overall search resulsts
              type: number
    GeneratedResource:
      type: "object"
      properties:
        id:
          type: "string"
          example: "c0ab3641-97bb-4601-9a8a-60bb9db59708"
        tenantId:
          type: "string"
          example: "pg.citya"
        fileStoreid:
          type: "string"
          example: "c0ab3641-97bb-4601-9a8a-60bb9db59708"
        type:
          type: "string"
          example: "facility"
        status:
          type: "string"
          example: "completed"
        count:
          type: "number"
          example: 100
        additionalDetails:
          type: "object"
          example : {}
        auditDetails:
          type: "object"
          properties:
            createdBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            lastModifiedBy:
              type: "string"
              example: "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
            createdTime:
              type: "string"
              example: "1644426612"
            lastModifiedTime:
              type: "string"
              example: "1644426612"
    Campaign:
      type: object
      properties:
        id:
          type: "string"
          format: uuid
          description: System generated unique identifier for the entry
          readOnly: true
        campaignNo:
          type: "string"
          example: CAM/2022-23/001
          description: System generated id with custom formatting
          readOnly: true
        referenceId:
          type: "string"
          format: uuid
          description: microplan id or bulk campaign process id
        hierarchyType:
          type: "string"
          example: admin
        tenantId:
          type: "string"
          example: mz
        campaignName:
          type: "string"
          example: bednet campaign
        boundaryCode:
          type: "string"
          example: "mz" 
          description: "root boundary code"
        startDate:
          type: number
          format: timestamp
          example: 1665497225000
          description: Timestamp of the start date in milliseconds
        endDate: 
          type: number
          format: timestamp
          example: 1665497225000
          description: Timestamp of the start date in milliseconds
        projectType:
          type: "string"
        CampaignDetails:
          $ref: '#/components/schemas/CampaignDetails'
        deliveryRules:
          type: "array"
          items:
            type: "object"
            properties:
              startDate:
                type: number
                format: timestamp
                example: 1665497225000
                description: Timestamp of the start date in milliseconds
              endDate:
                type: number
                format: timestamp
                example: 1665497225000
                description: Timestamp of the start date in milliseconds              
              cycle:
                type: "string"
        additionalDetails:
          type: "object"
    CampaignDetails:
      type: "array"
      items:
        type: "object"
        properties:
          id:
            type: "string"
            format: uuid
            description: System generated unique identifier for the entry
            readOnly: true
          boundaryCode:
            type: "string"
            example: "nampula"
          boundaryType:
            type: "string"
            example: "country|province"
          startDate:
            type: number
            format: timestamp
            example: 1665497225000
            description: Timestamp of the start date in milliseconds
          endDate:
            type: number
            format: timestamp
            example: 1665497225000
            description: Timestamp of the start date in milliseconds
          targets:
            type: "array"
            items:
              type: "object"
              properties:
                total:
                  type: "number"
                  example: 1000
                target:
                  type: "number"
                  example: 800
                type:
                  type: "string"
                  example: "household|individual"
          parentBoundaryCode:
            type: "string"
            example: "mz"
          projectId:
             type: "string"
          resources:
            type: "array"
            items:
              type: "object"
              properties:
                id:
                  type: "string"
                  format: uuid
                  description: System generated unique identifier for the entry
                  readOnly: true
                resourceIds:
                  type: "array"
                  items:
                    type: "string"
                    format: uuid
                    description: unique id of the relationship entity
                count:
                  type: "number"
                active:
                  type: "boolean"
                type:
                  type: "string"
                  example: "staff|resource|facility"
